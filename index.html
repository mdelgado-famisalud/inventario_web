<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Inventario</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="style.css"></script>
</head>
<body class="container py-4">
  <h1 class="mb-3">📦 Sistema de Inventario</h1>
  <!-- Top actions -->
  <div class="mb-3 d-flex flex-wrap gap-2 align-items-center">
    <input type="file" id="inputExcel" accept=".xlsx,.xls" style="display:none" onchange="importarExcel(event)">
    <button class="btn btn-outline-secondary btn-icon" onclick="document.getElementById('inputExcel').click()">📂
      Importar Excel</button>
    <input type="file" id="inputJSON" accept=".json" style="display:none" onchange="importarJSON(event)">
    <button class="btn btn-outline-secondary btn-icon" onclick="document.getElementById('inputJSON').click()">📂
      Importar JSON</button>
    <button class="btn btn-success btn-icon" onclick="exportarJSON()">💾 Exportar JSON</button>
    <button class="btn btn-success btn-icon" onclick="exportarExcel()">📊 Exportar Excel</button>
    <button class="btn btn-success btn-icon" onclick="exportarPDF()">📑 Exportar PDF</button>
    <button class="btn btn-danger btn-icon ms-auto" onclick="limpiarInventario()">🗑️ Limpiar Inventario</button>
  </div>
  <!-- Listas predefinidas -->
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">⚙️ Listas predefinidas (edítalas y se aplicarán a los selects)</h5>
      <div class="row g-2">
        <div class="col-md-6">
          <label class="form-label">Sedes (separadas por coma)</label>
          <input id="listaSedes" class="form-control" value="Central,Norte,Sur">
        </div>
        <div class="col-md-6">
          <label class="form-label">Pisos (separados por coma)</label>
          <input id="listaPisos" class="form-control" value="1,2,3">
        </div>
      </div>
      <div class="mt-2">
        <button class="btn btn-primary btn-sm" onclick="actualizarListas()">Aplicar listas</button>
        <small class="text-muted ms-2">Sedes y Pisos se usarán en los selects del formulario.</small>
      </div>
    </div>
  </div>
  <!-- Formulario (Categoría y Tipo son textboxes) -->
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">➕ Agregar / Editar item</h5>
      <form id="formInventario" class="row g-2">
        <input type="hidden" id="index" />
        <div class="col-md-4"><input id="descripcion" class="form-control" placeholder="Descripción" required /></div>
        <div class="col-md-2"><input id="cantidad" type="number" min="0" step="1" class="form-control"
            placeholder="Cantidad" required /></div>
        <div class="col-md-2"><input id="precio" type="number" min="0" step="0.01" class="form-control"
            placeholder="Precio" required /></div>
        <div class="col-md-2"><input id="codigo" class="form-control" placeholder="Código" /></div>
        <div class="col-md-2"><input id="fIngreso" type="date" class="form-control" /></div>
        <!-- Ahora son textboxes -->
        <div class="col-md-3"><input id="categoria" class="form-control" placeholder="Categoría (escribe aquí)" /></div>
        <div class="col-md-3"><input id="tipo" class="form-control" placeholder="Tipo (escribe aquí)" /></div>
        <!-- Sede y Piso siguen en select -->
        <div class="col-md-3"><select id="sede" class="form-select"></select></div>
        <div class="col-md-3"><select id="piso" class="form-select"></select></div>
        <div class="col-md-2"><input id="grupo" class="form-control" placeholder="Grupo" /></div>
        <div class="col-md-2"><input id="marca" class="form-control" placeholder="Marca" /></div>
        <div class="col-md-2"><input id="modelo" class="form-control" placeholder="Modelo" /></div>
        <div class="col-md-2"><input id="serie" class="form-control" placeholder="Serie" /></div>
        <div class="col-md-3"><input id="ubicacion" class="form-control" placeholder="Ubicación" /></div>
        <div class="col-md-4"><input id="observacion" class="form-control" placeholder="Observación" /></div>
        <div class="col-md-2">
          <button class="btn btn-primary w-100" type="submit">💾 Guardar</button>
        </div>
      </form>
    </div>
  </div>
  <!-- filtros y control registros por página -->
  <div class="d-flex gap-2 align-items-center mb-2">
    <input id="buscar" class="form-control me-2" placeholder="Buscar (se resalta)" oninput="onFiltroChange()" />
    <div class="ms-auto d-flex gap-2 align-items-center">
      <label class="mb-0">Mostrar</label>
      <select id="registrosPagina" class="form-select form-select-sm w-auto" onchange="cambiarRegistrosPorPagina()">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
      </select>
      <label class="mb-0">registros</label>
    </div>
  </div>
  <!-- tabla -->
  <div class="card mb-2">
    <div class="card-body">
      <h5 class="card-title">📋 Inventario</h5>
      <div class="table-responsive">
        <table id="tablaInventario" class="table table-striped table-hover table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th onclick="ordenarPor('descripcion')">Descripción <span id="icon-descripcion" class="flecha">⬍</span>
              </th>
              <th onclick="ordenarPor('cantidad')">Cantidad <span id="icon-cantidad" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('precio')">Precio <span id="icon-precio" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('codigo')">Código <span id="icon-codigo" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('fIngreso')">F-Ingreso <span id="icon-fIngreso" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('categoria')">Categoría <span id="icon-categoria" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('tipo')">Tipo <span id="icon-tipo" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('grupo')">Grupo <span id="icon-grupo" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('marca')">Marca <span id="icon-marca" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('modelo')">Modelo <span id="icon-modelo" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('serie')">Serie <span id="icon-serie" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('ubicacion')">Ubicación <span id="icon-ubicacion" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('piso')">Piso <span id="icon-piso" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('sede')">Sede <span id="icon-sede" class="flecha">⬍</span></th>
              <th onclick="ordenarPor('observacion')">Observación <span id="icon-observacion" class="flecha">⬍</span>
              </th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <!-- totalizador -->
      <div id="totalizador" class="mt-2 fw-semibold"></div>
      <!-- paginación -->
      <div id="paginacion" class="mt-2 d-flex align-items-center gap-2 flex-wrap"></div>
    </div>
  </div>
  <!-- historial -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">📜 Historial de movimientos</h5>
      <button class="btn btn-danger btn-sm mb-2" onclick="limpiarHistorial()">🧹 Limpiar historial</button>
      <div class="table-responsive">
        <table id="tablaHistorial" class="table table-sm table-striped table-bordered">
          <thead class="table-secondary">
            <tr>
              <th>Fecha</th>
              <th>Acción</th>
              <th>Detalle</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- Toasts (Bootstrap) -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
    <div id="toastDuplicado" class="toast align-items-center text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">✅ Registro duplicado y guardado con éxito</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
</body>
</html>